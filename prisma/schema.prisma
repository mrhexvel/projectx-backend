generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

model User {
    id            String        @id @default(cuid())
    email         String        @unique
    emailVerified Boolean       @default(false)
    passwordHash  String?
    name          String?
    headline      String?
    avatarUrl     String?
    publicHandle  String?       @unique
    locale        String?       @default("en")
    createdAt     DateTime      @default(now())
    updatedAt     DateTime      @updatedAt
    profiles      Profile[]
    projects      Project[]
    achievements  Achievement[]
    resumes       Resume[]
    sessions      Session[]
}

model Session {
    id        String   @id @default(cuid())
    user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
    userId    String
    expiresAt DateTime
    createdAt DateTime @default(now())
}

model Profile {
    id        String   @id @default(cuid())
    user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
    userId    String   @unique
    bio       String?
    links     Link[]
    visible   Boolean  @default(true)
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model Resume {
    id          String          @id @default(cuid())
    user        User            @relation(fields: [userId], references: [id], onDelete: Cascade)
    userId      String
    title       String
    slug        String          @unique
    description String?
    isPublished Boolean         @default(false)
    createdAt   DateTime        @default(now())
    updatedAt   DateTime        @updatedAt
    versions    ResumeVersion[]
}

model ResumeVersion {
    id         String   @id @default(cuid())
    resume     Resume   @relation(fields: [resumeId], references: [id], onDelete: Cascade)
    resumeId   String
    content    String // markdown or structured JSON
    versionTag String?
    createdAt  DateTime @default(now())
    aiScore    Float?
}

model Project {
    id          String         @id @default(cuid())
    user        User           @relation(fields: [userId], references: [id], onDelete: Cascade)
    userId      String
    title       String
    slug        String         @unique
    shortDesc   String?
    description String?
    techStack   String[]       @default([])
    links       Link[]
    media       ProjectMedia[]
    visibility  Visibility     @default(PUBLIC)
    createdAt   DateTime       @default(now())
    updatedAt   DateTime       @updatedAt
}

model ProjectMedia {
    id        String    @id @default(cuid())
    project   Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)
    projectId String
    url       String
    type      MediaType
    altText   String?
    createdAt DateTime  @default(now())
}

model Achievement {
    id        String    @id @default(cuid())
    user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
    userId    String
    title     String
    body      String?
    date      DateTime?
    link      String?
    createdAt DateTime  @default(now())
    updatedAt DateTime  @updatedAt
}

model Link {
    id        String   @id @default(cuid())
    url       String
    title     String?
    profile   Profile? @relation(fields: [profileId], references: [id], onDelete: Cascade)
    profileId String?
    project   Project? @relation(fields: [projectId], references: [id], onDelete: Cascade)
    projectId String?
    createdAt DateTime @default(now())
}

enum Visibility {
    PUBLIC
    PRIVATE
    UNLISTED
}

enum MediaType {
    IMAGE
    VIDEO
    FILE
}
